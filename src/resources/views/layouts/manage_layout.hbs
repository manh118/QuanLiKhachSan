<!DOCTYPE html>
<html lang="en">
     <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
          <title>Qu·∫£n L√Ω - An B√¨nh</title> 
          <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">    
          <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
          <link rel="manifest" href="/favicon/manifest.json">
          <meta name="msapplication-TileColor" content="#ffffff">
          <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
          <meta name="theme-color" content="#ffffff">
      
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
          <link rel="stylesheet" href="/css/main.css"> 
          <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"> 
          <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">


          {{!-- V√≠ d·ª•: <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"> --}}

     </head>
     <body>

          <div class="app">

               {{> manage_header}} {{!-- Partial header c·ªßa trang qu·∫£n l√Ω --}}

               {{{body}}} {{!-- N·ªôi dung ch√≠nh c·ªßa t·ª´ng trang qu·∫£n l√Ω --}}

          </div>

          {{!-- jQuery and Bootstrap JS (Gi·ªØ nguy√™n) --}}
          <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
          <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>

          {{!-- === B·∫ÆT ƒê·∫¶U: TH√äM CODE SOCKET.IO === --}}

          {{!-- 1. Script c·ªßa Socket.IO client --}}
          <script src="/socket.io/socket.io.js"></script>

          {{!-- 2. Th·∫ª audio ƒë·ªÉ ph√°t √¢m thanh --}}
          <audio id="bookingNotificationSound" src="/sounds/notification.mp3" preload="auto"></audio>

          {{!-- (T√πy ch·ªçn) Th√™m th∆∞ vi·ªán th√¥ng b√°o pop-up ƒë·∫πp h∆°n alert --}}
          {{!-- V√≠ d·ª•: <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script> --}}

          {{!-- 3. Script l·∫Øng nghe s·ª± ki·ªán t·ª´ server --}}
          <script>
              document.addEventListener('DOMContentLoaded', function() {
                  // K·∫øt n·ªëi t·ªõi server WebSocket
                  const socket = io();
                  const notificationSound = document.getElementById('bookingNotificationSound');

                  // (T√πy ch·ªçn) C·∫•u h√¨nh th∆∞ vi·ªán th√¥ng b√°o (v√≠ d·ª• Toastr)
                  // if (typeof toastr !== 'undefined') {
                  //     toastr.options = {
                  //         "closeButton": true,
                  //         "progressBar": true,
                  //         "positionClass": "toast-top-right",
                  //         "timeOut": "10000", // Hi·ªÉn th·ªã 10 gi√¢y
                  //     };
                  // }

                  // L·∫Øng nghe s·ª± ki·ªán 'new_booking' t·ª´ server
                  socket.on('new_booking', (data) => {
                      console.log('üîî Nh·∫≠n ƒë∆∞·ª£c booking m·ªõi:', data);

                      // 1. Ph√°t √¢m thanh
                      if (notificationSound) {
                          notificationSound.play().catch(e => console.error("L·ªói ph√°t √¢m thanh:", e));
                      } else {
                          console.warn("Kh√¥ng t√¨m th·∫•y th·∫ª audio 'bookingNotificationSound'");
                      }

                      // 2. Hi·ªÉn th·ªã Pop-up
                      const popupMessage = `Ph√≤ng ${data.bookingDetails.roomNumber} v·ª´a ƒë∆∞·ª£c ƒë·∫∑t b·ªüi ${data.bookingDetails.customerName}!`;
                      alert("üîî ƒê·∫∑t Ph√≤ng M·ªõi!\n" + popupMessage); // D√πng alert ƒë∆°n gi·∫£n

                      // Ho·∫∑c d√πng th∆∞ vi·ªán th√¥ng b√°o (v√≠ d·ª• Toastr)
                      // if (typeof toastr !== 'undefined') {
                      //     toastr.info(popupMessage, 'Th√¥ng B√°o ƒê·∫∑t Ph√≤ng M·ªõi');
                      // } else {
                      //     alert("üîî ƒê·∫∑t Ph√≤ng M·ªõi!\n" + popupMessage); // Fallback v·ªÅ alert
                      // }


                      // 3. (T√πy ch·ªçn) C·∫≠p nh·∫≠t giao di·ªán ƒë·ªông
                      // N·∫øu mu·ªën t·ª± ƒë·ªông l√†m m·ªõi trang t·ªïng quan khi c√≥ booking m·ªõi:
                       if (window.location.pathname === '/manage') {
                           console.log('ƒêang ·ªü trang t·ªïng quan, xem x√©t t·∫£i l·∫°i...');
                           // B·∫°n c√≥ th·ªÉ th√™m ƒë·ªô tr·ªÖ nh·ªè tr∆∞·ªõc khi t·∫£i l·∫°i
                           // setTimeout(() => { window.location.reload(); }, 1000);
                       }
                  });

                  socket.on('connect', () => { console.log('üîå WebSocket ƒë√£ k·∫øt n·ªëi.'); });
                  socket.on('disconnect', () => { console.warn('üîå WebSocket ƒë√£ m·∫•t k·∫øt n·ªëi.'); });
                  socket.on('connect_error', (err) => { console.error(' L·ªói k·∫øt n·ªëi WebSocket:', err); });
              });
          </script>

          

     </body>
</html>